---
title: "Plot Figures"
author: "Sihan Chen, Richard Futrell, Kyle Mahowald"
date: '2022-09-25'
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(paletteer)
library(tidyverse)
library(ggrepel)
library(RColorBrewer)
library(ggnewscale)
library(latex2exp)
library(gridExtra)
library(ggrepel)
```

Insert descriptions here I guess

Parameters:
```{r}
# decay parameter
mu <- 0.2
# P/G/S coordinates
pgs <- '0.0_-0.789_1.316'
# number of distal levels
num_dists <- 'num_dists_3'
```

Load datasheets generated by run_ib_new.py
```{r}
# output file 
d = read.csv(paste0('sheets/_mu_',toString(mu),'_pgs', pgs, num_dists, '.csv'))  %>%
  mutate(Language = gsub('\\[(.*?)\\]', '', Language),
         Language_family = str_extract(Language, "(?<=\\()(.*?)(?=,|\\))")) %>% pivot_longer(2:10, names_to = 'mode', values_to = 'word') %>%
  separate(mode, into = c('distal_level', 'orientation'), sep = '_') %>% group_by(Language) %>% 
  mutate(word = as.character(word) %>% factor(levels = unique(.)) %>% as.numeric()) %>% ungroup() %>%
  unite('mode', c('distal_level', 'orientation'), sep = '_') %>%
  pivot_wider(names_from = mode, values_from = word)

# non-deterministic optimal frontier
curve_non_deter = read.csv(paste0('sheets/_mu_',toString(mu),'_pgs', pgs, num_dists, '_ib_curve.csv'))

# get columns indicating the (distal_level, orientation) combinations
co <- which(!is.na(str_extract(colnames(d), 'D\\d_')))

# calculate number of words 
d[, "nwords"] <- apply(d[,co], 1, max)

# color patelle for plotting
colourCount = 9
getPalette = colorRampPalette(brewer.pal(9, "Set1"))

```


### Data sheet 1: Real paradigm summary

A paradigm is defined as a group of lexicons sharing the same partition of the meaning space. For example, both English and Maltese merge Place and Goal and have two distal levels, along with 21 other languages. These 23 languages are said to share the same paradigm.

From the sheet, among the 220 languages in the database, there are only 34 paradigms.
```{r}
set.seed(20230316)
real_paradigm_summary <- d %>% filter(LangCategory == 'real') %>% 
  group_by_at(vars(starts_with('D', ignore.case = FALSE))) %>% 
  slice_sample(n=1) %>% 
  left_join(d %>% 
              group_by_at(vars(starts_with('D', ignore.case = FALSE))) 
            %>% summarise(n = n())) %>% 
  ungroup() %>% 
  mutate(Language = gsub('^\\s+', '', Language))
```

### Generate plots:
Figure 1 in the paper: complexity - informativity tradeoff illustration:
```{r}
most_informative_example <- tibble(orientation = c('goal', 'place', 'source', 'goal', 'place', 'source', 'goal', 'place', 'source',
                                                   'goal', 'place', 'source', 'goal', 'place', 'source', 'goal', 'place', 'source'),
                                   distal_level = c('D1', 'D1', 'D1', 'D2', 'D2', 'D2', 'D3', 'D3', 'D3',
                                                    'D1', 'D1', 'D1', 'D2', 'D2', 'D2', 'D3', 'D3', 'D3'),
                                   word = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 2,2,2,2,2,2,2,2,2),
                                   cat = c(rep("Most informative", 9), rep("Most simple", 9)))

systematic_example <- tibble(orientation = c('goal', 'place', 'source', 'goal', 'place', 'source', 'goal', 'place', 'source',
                                                   'goal', 'place', 'source', 'goal', 'place', 'source', 'goal', 'place', 'source'),
                                   distal_level = c('D1', 'D1', 'D1', 'D2', 'D2', 'D2', 'D3', 'D3', 'D3',
                                                    'D1', 'D1', 'D1', 'D2', 'D2', 'D2', 'D3', 'D3', 'D3'),
                                   word = c(1,1,2,3,3,4,3,3,4,1,2,2,3,1,3,4,2,3),
                                   cat = c(rep("systematic", 9), rep("non_systematic", 9)))


ggplot(most_informative_example, aes(x = orientation, y = distal_level, fill = as.factor(word))) +
  geom_tile() +
  facet_wrap(~cat) +
  scale_fill_manual(values = getPalette(colourCount)) +
  xlab('Orientation') +
  ylab('Distal Level') +
  theme_bw(25) +
  theme(legend.position = 'none') 

#ggsave(paste0('figures/mu_', toString(mu), 'tradeoff_illu_', num_dists, '.png'), width = 8, height = 4, unit = 'in')
ggsave(paste0('figures/paper_figures/Figure 1.png'), width = 8, height = 4, units = 'in')
```

Figure 3 in the paper: examples of systematic and non-systematic lexicons
```{r}
systematic_plot <- ggplot(d %>% filter(Language == 'English (Indo-European, Germanic)') %>% 
               pivot_longer(co,names_to = 'mode', values_to = 'word') %>% 
               separate(mode, into = c('distal_level', 'orientation'), sep = '_'), 
             aes(x = orientation, y = distal_level, fill = as.factor(word))) +
  geom_tile() +
  facet_wrap(~Language) +
  scale_fill_manual(values = getPalette(colourCount)) +
  xlab('Orientation') +
  ylab('Distal Level') +
  theme_bw(17) +
  guides(fill = guide_legend(title = 'Word')) 

non_systematic_viz <- ggplot(d %>% filter(X==11532) %>% 
               pivot_longer(co, names_to = 'mode', values_to = 'word') %>% 
               separate(mode, into = c('distal_level', 'orientation'), sep = '_'), 
             aes(x = orientation, y = distal_level, fill = as.factor(word))) +
  geom_tile() +
  facet_wrap(~Language) +
  scale_fill_manual(values = getPalette(colourCount)) +
  xlab('Orientation') +
  ylab('Distal Level') +
  theme_bw(17) +
  guides(fill = guide_legend(title = 'Word')) 

w <- grid.arrange(systematic_plot, non_systematic_viz, ncol=2)
#ggsave(paste0('figures/mu_', toString(mu), '_suystematicity_illu_', num_dists, '.png'), plot = w, width = 12, height = 4, unit = 'in')
ggsave(plot =w, paste0('figures/paper_figures/Figure 3.png'), width = 12, height = 4, units = 'in')

```
Figure 4 in the paper: real and simulated lexicons, along with the optimal frontier, on the information plane

```{r}
pos <- position_jitter(height = 0.01, width = 0.01, seed = 2)


annotation_plot <- ggplot(d %>% filter(LangCategory == 'real') %>%
                            mutate(Area = str_to_title(Area))) +
  geom_point(data = d %>% filter(LangCategory == 'simulated'), aes(x=`I.M.W.`, y=`I.U.W.`), alpha = 0.1, size = 3, color = 'gray') +
  geom_jitter(aes(x=`I.M.W.`, y=`I.U.W.`, color = Area), size = 3, position = pos) +
  theme_bw() +
  scale_color_brewer(palette = 'Set2') +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        axis.title = element_blank(), legend.position = 'none') +
  ggtitle('Finnish, Fijian, and 48 other languages') +
  xlim(1.75, 1.765) +
  ylim(0.60, 0.64)

annotation_plot_2 <- ggplot(d %>% filter(LangCategory == 'real') %>%
                            mutate(Area = str_to_title(Area))) +
  geom_point(data = d %>% filter(LangCategory == 'simulated'), aes(x=`I.M.W.`, y=`I.U.W.`), alpha = 0.1, size = 3, color = 'gray') +
  geom_jitter(aes(x=`I.M.W.`, y=`I.U.W.`, color = Area), size = 3, position = pos) +
  theme_bw() +
  scale_color_brewer(palette = 'Set2') +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        axis.title = element_blank(), legend.position = 'none') +
  ggtitle('English and 21 other languages') +
  xlim(0.98, 1.005) +
  ylim(0.4, 0.44)

ggplot(d %>% filter(LangCategory == 'real') %>%
         mutate(Area = str_to_title(Area))) +
  geom_point(data = d %>% filter(LangCategory == 'simulated'), aes(x=`I.M.W.`, y=`I.U.W.`), alpha = 0.1, size = 3, color = 'gray') +
  geom_jitter(aes(x=`I.M.W.`, y=`I.U.W.`, color = Area), size = 3, position = pos) +
  geom_line(data = curve_non_deter, aes(x = complexity, y = informativity ), color = 'black', size = 1) +
  geom_smooth(data = d %>% filter(LangCategory == 'simulated'), aes(x=`I.M.W.`, y=`I.U.W.`), method = 'lm', color ='blue', 
              linetype='dashed') +
  theme_bw(25) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  xlab('Complexity') +
  ylab('Informativity') +
  xlim(0,max(d$I.M.W.) + 0.35) +
  ylim(0,max(d$I.U.W.) + 0.10) +
  scale_color_brewer(palette = 'Set2') +
  geom_text_repel(data = d %>% filter(Language %in% c('Abau (Sepik, Upper) ',
                                                      '  Doromu-Koki (Trans-New Guinea, Manubaran) ',
                                                      'Balese (Central Sudanic)',
                                                      'Abui (Timor-Alor-Pantar, Alor) ',
                                                      '  Orokaiva (Trans-New Guinea, Binanderean)'
                                                      )),
                  aes(x = I.M.W., y = I.U.W., label = Language),
                  point.padding = 0.1,
                  nudge_x = 0.05,
                  nudge_y = -0.15,
                  segment.curvature = -1e-20,
                  arrow = arrow(length = unit(0.01, "npc")),
                  #position = pos
  )+
  geom_text_repel(data = d %>% filter(Language %in% c('  Dyirbal (Pama-Nyungan)',
                                                      '  Maybrat (Maybrat-Karon) ',
                                                      'Hmong Njua (Hmong-Mien, Chuanqiandian)',
                                                      'English (Indo-European, Germanic)',
                                                      'Bengali (Indo-European, Indo-Iranian)'
                                                      )),
                  aes(x = I.M.W., y = I.U.W., label = Language),
                  point.padding = 0.1,
                  nudge_x = -0.05,
                  nudge_y = 0.1,
                  segment.curvature = -1e-20,
                  arrow = arrow(length = unit(0.015, "npc"))
  )+
  geom_text_repel(data = d %>% filter(Language %in% c('  Fijian (Austronesian, Oceanic)',
                                                      'Finnish (Uralic)'
                                                      )),
                  aes(x = I.M.W., y = I.U.W., label = Language),
                  #point.padding = 0.1,
                  nudge_x = 0.3,
                  nudge_y = 0.01,
                  segment.curvature = -1e-20,
                  arrow = arrow(length = unit(0.015, "npc"))
  )+
  ggtitle('') +
  geom_rect(aes(xmin= 1.75, xmax=1.765, ymin=0.6, ymax=0.64), color='black', linetype='dashed', alpha=0) +
  geom_rect(aes(xmin= 0.98, xmax=1.005, ymin=0.4, ymax=0.44), color='black', linetype='dashed', alpha=0) +
  annotation_custom(ggplotGrob(annotation_plot), xmin=1.5, xmax=2, ymin=0, ymax=0.2) +
  geom_rect(aes(xmin=1.5, xmax=2, ymin=0, ymax=0.2), color='black', linetype='dashed', alpha=0) +
  geom_path(aes(x,y,group=grp), 
          data=data.frame(x = c(1.75,1.5,1.765,2), y=c(0.6,0.2,0.6,0.2),grp=c(1,1,2,2)),
          linetype='dashed') +
  annotation_custom(ggplotGrob(annotation_plot_2), xmin=0, xmax=0.5, ymin=0.5, ymax=0.7) +
  geom_rect(aes(xmin=0, xmax=0.5, ymin=0.5, ymax=0.7), color='black', linetype='dashed', alpha=0) +
  geom_path(aes(x,y,group=grp), 
          data=data.frame(x = c(0.98,0,0.98,0.5), y=c(0.4,0.5,0.44,0.5),grp=c(1,1,2,2)),
          linetype='dashed') 
  

#ggsave(paste0('figures/Efficient_frontier_mu_',toString(mu),'_pgs_', pgs, num_dists, '.png'), width = 15.3, height = 9, units = 'in')
ggsave(paste0('figures/paper_figures/Figure 4.png'), width = 15.3, height = 9, units = 'in')

```

Colored by language families
```{r}
set.seed(20230119)
colourCount = d$Language_family %>% unique() %>% length()
clrs <- paletteer_d("palettesForR::LaTeX", colourCount)

pos <- position_jitter(height = 0.01, width = 0.01, seed = 2)
ggplot(d %>% filter(LangCategory == 'real') %>% group_by(Language_family) %>% sample_n(size=1)) +
  geom_point(data = d %>% filter(LangCategory == 'simulated'), aes(x=`I.M.W.`, y=`I.U.W.`), alpha = 0.1, size = 3, color = 'gray') +
  geom_jitter(aes(x=`I.M.W.`, y=`I.U.W.`, color = Language_family), size = 3, position = pos) +
  geom_line(data = curve_non_deter, aes(x = complexity, y = informativity ), color = 'black', size = 1) +
  geom_smooth(data = d %>% filter(LangCategory == 'simulated'), aes(x=`I.M.W.`, y=`I.U.W.`), method = 'lm', color ='blue', 
              linetype='dashed') +
  theme_bw() +
  theme(panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        legend.position = 'bottom',
        text = element_text(size=25)) +
  xlab('Complexity') +
  ylab('Informativity') +
  xlim(0,max(d$I.M.W.) + 0.35) +
  ylim(0,max(d$I.U.W.) + 0.10) +
  scale_color_manual(values = clrs) +
  geom_text_repel(data = d %>% filter(Language %in% c('Abau (Sepik, Upper) ',
                                                      '  Doromu-Koki (Trans-New Guinea, Manubaran) ',
                                                      'Balese (Central Sudanic)')),
                  aes(x = I.M.W., y = I.U.W., label = Language),
                  point.padding = 0.1,
                  nudge_x = -0.05,
                  nudge_y = -0.05,
                  segment.curvature = -1e-20,
                  arrow = arrow(length = unit(0.015, "npc")),
                  #position = pos
  )+
  geom_text_repel(data = d %>% filter(Language %in% c('  Dyirbal (Pama-Nyungan)',
                                                      '  Kodiak Alutiiq (Eskimo-Aleut, Aleut) ',
                                                      'Hmong Njua (Hmong-Mien, Chuanqiandian)',
                                                      'English (Indo-European, Germanic)'
                                                      )),
                  aes(x = I.M.W., y = I.U.W., label = Language),
                  point.padding = 0.1,
                  nudge_x = -0.05,
                  nudge_y = 0.05,
                  segment.curvature = -1e-20,
                  arrow = arrow(length = unit(0.015, "npc"))
  )+
  ggtitle('')
ggsave(paste0('figures/paper_figures/Figure 4_by_family.png'), width = 20, height = 15, units = 'in')

```

Figure 6 in the paper: most efficient real and simulated paradigms
```{r}
# color patelle for plotting
colourCount = 9
getPalette = colorRampPalette(brewer.pal(9, "Set1"))

# filter out optimal real lexicons 
real_lexicon_opts <- real_paradigm_summary %>% slice_min(order_by = gNID, n=5)
real_lexicon_opts_viz <- real_lexicon_opts %>% pivot_longer(co,names_to = 'mode', values_to = 'word') %>% 
  separate(mode, into = c('distal_level', 'orientation'), sep = '_')

p1 <- ggplot(real_paradigm_summary %>% mutate(Language = gsub('\\((.*?)\\)', '', Language),
                                              Label = paste0(str_sub(Language, 1, -2), "(", n, "), gNID = ", 
                                                             sprintf('%.4f', as.numeric(gNID))))  %>% filter() %>%
               slice_min(order_by = gNID, n =5) %>% 
               pivot_longer(co, names_to = 'mode', values_to = 'word') %>%
               separate(mode, into = c('distal_level', 'orientation'), sep = '_'),  
             aes(x = orientation, y = distal_level, fill = as.factor(word))) +
  facet_wrap(~reorder(Label, nwords), nrow=2 ) +
  geom_tile() +
  scale_fill_manual(values = getPalette(colourCount)) +
  xlab('Orientation') +
  ylab('Distal Level') +
  theme_bw(17) +
  guides(fill = guide_legend(title = 'Word')) +
  ggtitle('real paradigms')
#ggsave(paste0('figures/mu_', toString(mu), '_optimal_simulated_lexicon_', num_dists, '.png'), plot = p1, width = 12, height = 4, unit = 'in')

# filter out optimal simulated lexicons 
sim_lexicon_opts <- d %>% filter(LangCategory == 'simulated') %>% slice_min(order_by = gNID, n=5) 
sim_lexicon_opts_viz <- sim_lexicon_opts %>% pivot_longer(co,names_to = 'mode', values_to = 'word') %>% 
  separate(mode, into =c('distal_level', 'orientation'), sep = '_')

p2 <- ggplot(sim_lexicon_opts_viz %>% mutate(label = paste0(X, " (", 1, "), gNID = ", sprintf('%.4f', as.numeric(gNID)))), 
       aes(x = orientation, y = distal_level, fill = as.factor(word))) +
  facet_wrap(~reorder(label, nwords), nrow = 2, ncol = 4) +
  geom_tile() +
  scale_fill_manual(values = getPalette(colourCount)) +
  xlab('Orientation') +
  ylab('Distal Level') +
  theme_bw(17) +
  guides(fill = guide_legend(title = 'Word')) +
  ggtitle('simulated paradigms')
# ggsave(paste0('figures/mu_0.3_optimal_simulated_lexicon', num_dists, '.png'), plot = p2, height = 4, width = 12, unit = 'in')

p <- grid.arrange(p1,p2, nrow=2)
# ggsave(paste0('figures/mu_', toString(mu), '_optimal_lexicon_', num_dists, '.png'), plot = p, width = 15, height = 12, unit = 'in')
ggsave(plot = p, paste0('figures/paper_figures/Figure 6.png'), width = 15, height = 12, units = 'in')
```


Consistency vs. gNID, faceted by number of words
```{r}
ggplot(d %>% filter(LangCategory=='simulated'), aes(y=systematicity, x=gNID)) +
  facet_grid(rows=vars(nwords)) +
  geom_jitter(alpha=0.2, color='gray50', size=1) +
  geom_jitter(data=real_paradigm_summary, aes(x = gNID, y = systematicity, size=n), color='blue') +
  theme_bw(25) +
  scale_y_continuous(breaks=c(2,6), labels=c("2" = "consistent", "6" = "not consistent")) +
  scale_size_continuous(breaks=c(5, 10,20,30,40,50,60), range = c(1, 10)) +
  guides(size=guide_legend(title='Number of languages')) +
  ylab('Consistency') +
  theme(panel.grid.minor = element_blank())
  
ggsave(paste0('figures/paper_figures/consistency.png'), width = 15, height = 12, units = 'in')


```




Supplementary figure: alternative complexity metric - number of words 
```{r}
pos <- position_jitter(height = 0.01, width = 0.01, seed = 2)
ggplot(d %>% filter(LangCategory == 'real')) +
  geom_point(data = d %>% filter(LangCategory == 'simulated'), aes(x=nwords, y= `I.U.W.`), alpha = 0.1, size = 3, color = 'gray') +
  geom_jitter(aes(x=nwords, y= `I.U.W.`, color = Area), size = 3, position = pos) +
  #geom_line(data = curve_non_deter, aes(x = complexity, y = informativity ), color = 'black', size = 1) +
  theme_bw(25) +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  xlab('Complexity as in number of words') +
  ylab('Informativity') +
  #xlim(0,max(d$nwords) + 0.35) +
  #ylim(0,max(d$I.U.W.) + 0.10) +
  scale_color_brewer(palette = 'Set2') +
  geom_text_repel(data = d %>% filter(Language %in% c('Abau (Sepik, Upper) ',
                                                      '  Doromu-Koki (Trans-New Guinea, Manubaran) ',
                                                      'Balese (Central Sudanic)')),
                  aes(x=nwords, y= `I.U.W.`, label = Language),
                  point.padding = 0.1,
                  nudge_x = -0.05,
                  nudge_y = -0.05,
                  segment.curvature = -1e-20,
                  arrow = arrow(length = unit(0.015, "npc")),
                  #position = pos
  )+
  geom_text_repel(data = d %>% filter(Language %in% c('  Dyirbal (Pama-Nyungan)',
                                                      '  Kodiak Alutiiq (Eskimo-Aleut, Aleut) ',
                                                      'Hmong Njua (Hmong-Mien, Chuanqiandian)',
                                                      'English (Indo-European, Germanic)'
                                                      )),
                  aes(x=nwords, y= `I.U.W.`, label = Language),
                  point.padding = 0.1,
                  nudge_x = -0.05,
                  nudge_y = 0.05,
                  segment.curvature = -1e-20,
                  arrow = arrow(length = unit(0.015, "npc"))
  )+
  ggtitle('')


ggsave(paste0('figures/paper_figures/supp_1.png'), width = 15, height = 12, units = 'in')
```

Supplementary figure: number of words vs. systematicity
```{r}
fig_nwords_systematicity_1 <- ggplot(d %>% filter(Language == 'simulated')) + 
  geom_jitter(aes(x=log(nwords), y=systematicity),height = 0.3, width = 0.3) +
  xlab('Complexity as in log number of words') +
  ylab('Systematicity') +
  theme_classic(25)



fig_nwords_systematicity_2 <-ggplot(d %>% filter(Language == 'simulated')) +
  geom_jitter(aes(x=`I.M.W.`, y=systematicity),height = 0.3, width = 0.02) +
  xlab('Complexity') +
  ylab('Systematicity') +
  theme_classic(25)

fig_nwords_systematicity <- grid.arrange(fig_nwords_systematicity_1, fig_nwords_systematicity_2, ncol=2)
ggsave(plot = fig_nwords_systematicity, paste0('figures/paper_figures/supp_2.png'), width = 15, height = 6, units = 'in')
# both give an R^2 of around 0.18
lm(systematicity ~ nwords, data=d %>% filter(Language=='simulated')) %>% summary()
lm(systematicity ~ `I.M.W.`, data=d %>% filter(Language=='simulated')) %>% summary()
```

Playgrounds for now
```{r}

ggplot(d, aes(x = `I.M.W.`, y = `I.U.W.`, color = gNID)) +
  facet_grid(rows = vars(LangCategory), cols = vars(systematicity)) +
  geom_jitter(width = 0.02, height = 0.005) +
  geom_point(data=curve_non_deter, aes(x=complexity, y=informativity), color = 'red', alpha = 0.2) +
  theme_bw(15)

ggplot() +
  geom_point(data=d %>% filter(LangCategory == 'simulated'), aes(x=gNID, y=systematicity), color='black', alpha = 0.1) +
  geom_point(data=real_paradigm_summary, aes(x=gNID, y=systematicity, size=n), color='blue') +
  theme_bw(15)

```

Stats playground

which is a good predictor of optimality, as defined by gNID?
```{r}
m1 <- lm(gNID ~ `I.U.W.` + systematicity, data=d %>% filter(LangCategory=='simulated'))
m2 <- lm(gNID ~ `I.M.W.` + `I.U.W.`, data=d %>% filter(LangCategory=='simulated')) 
m3 <- lm(gNID ~ `I.M.W.` + `I.U.W.` + systematicity, data=d %>% filter(LangCategory=='simulated')) 

anova(m1,m3)
anova(m2,m3)



```



